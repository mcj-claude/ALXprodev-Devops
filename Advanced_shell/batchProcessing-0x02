#!/bin/bash

# Script: batchProcessing-0x02
# Purpose: Fetch multiple Pokémon data and save each to pokemon_data/<name>.json
# Handles rate limiting with delay between requests

# List of Pokémon to fetch
POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Directory to store results
OUTPUT_DIR="pokemon_data"

# Create output directory if it doesn't exist
mkdir -p "$OUTPUT_DIR"

# Base API URL
BASE_URL="https://pokeapi.co/api/v2/pokemon/"

echo "Starting batch fetch of Pokémon data..."

# Loop through each Pokémon
for pokemon in "${POKEMON_LIST[@]}"; do
    echo "Fetching data for $pokemon..."
    
    # Build full URL and output file
    url="${BASE_URL}${pokemon,,}"  # Convert to lowercase just in case
    filename="$OUTPUT_DIR/${pokemon,,}.json"
    
    # Make request and save response
    if curl -s -f "$url" -o "$filename"; then
        echo "Saved data to $filename Success"
    else
        echo "Failed to fetch $pokemon (status: $?)" >&2
        # Optional: save empty file or skip
        > "$filename"  # create empty file for consistency
    fi
    
    # Be respectful to the API - add 1 second delay between requests
    sleep 1
done

echo "Batch processing complete!"